<!DOCTYPE html>
<html>
<head>
    <!-- [Previous head content remains unchanged] -->
</head>
<body>
    <div class="container">
        <h2>üé´ Advanced Ticket Pricing Calculator</h2>
        
        <div class="input-group">
            <label>Wholesale Price per Ticket ($)</label>
            <input type="number" step="0.01" id="wholesale" required>
            <div class="note">Base price without any additional costs</div>
        </div>

        <div class="input-group">
            <label>Quantity</label>
            <input type="number" id="quantity" value="1" min="1" required>
        </div>

        <div class="input-group">
            <label>Tax Percentage (%)</label>
            <input type="number" step="0.1" id="tax_percent" value="0">
        </div>

        <div class="input-group">
            <label>Partner Markup Type</label>
            <select id="markup_type">
                <option value="fixed">Fixed Amount</option>
                <option value="percent">Percentage</option>
            </select>
        </div>

        <div class="input-group">
            <label>Partner Markup Value</label>
            <input type="number" step="0.01" id="markup_value" value="0">
        </div>

        <!-- New Service Fee Input -->
        <div class="input-group">
            <label>Service Fee Percentage (%)</label>
            <input type="number" step="0.1" id="service_fee_percent" value="4.5">
            <div class="note">Enter custom service fee percentage</div>
        </div>

        <button onclick="calculate()">Calculate Total Price</button>

        <div class="result">
            <div class="calculation-steps">
                <h3>Detailed Calculation Breakdown</h3>
                <div id="detailed_calculation"></div>
            </div>

            <hr>

            <div class="total-summary">
                <p class="tax-calculation">Tax per Ticket: 
                    <span id="tax_per_unit">$0</span>
                    <span class="note" id="tax_calculation"></span>
                </p>
                <p class="profit-margin">Profit Margin after Markup: 
                    <span id="profit_margin">$0</span> 
                    (<span id="profit_margin_percent">0%</span>)
                </p>
                <p>Total Before Fees: <span id="total_before_fee">$0</span></p>
                <p>Service Fee (<span id="service_fee_rate">4.5</span>%): <span id="service_fee">$0</span></p>
                <p class="price-per-ticket">Final Total Price: 
                    <span id="final_price">$0</span><br>
                    <span class="currency-rate" id="final_price_eur">‚Ç¨0</span>
                    <span class="currency-rate" id="final_price_gbp">¬£0</span>
                </p>
                <p>Price per Ticket: <span id="price_per_ticket">$0</span></p>
            </div>
        </div>
    </div>

    <script>
        // [Previous exchange rate fetch code remains unchanged]

        function roundUpToWhole(value) {
            return Math.ceil(value);
        }

        function calculate() {
            // –í–∞–ª–∏–¥–∞—Ü–∏—è –≤–≤–æ–¥–∞
            const wholesale = parseFloat(document.getElementById('wholesale').value);
            if (isNaN(wholesale)) {
                alert('Please enter a valid wholesale price');
                return;
            }

            const quantity = parseInt(document.getElementById('quantity').value) || 1;
            const taxPercent = parseFloat(document.getElementById('tax_percent').value) || 0;
            const markupType = document.getElementById('markup_type').value;
            const markupValue = parseFloat(document.getElementById('markup_value').value) || 0;
            const serviceFeePercent = parseFloat(document.getElementById('service_fee_percent').value) || 0;

            // –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞—Å—á–µ—Ç—ã
            const totalWholesale = roundUpToWhole(wholesale * quantity);
            
            // –ù–∞—Ü–µ–Ω–∫–∞ Tevo
            let tevoMarkup;
            if (wholesale < 500) {
                tevoMarkup = 75;
            } else if (wholesale < 1000) {
                tevoMarkup = 125;
            } else {
                tevoMarkup = roundUpToWhole(wholesale * 0.12);
            }

            // –†–æ–∑–Ω–∏—á–Ω–∞—è —Ü–µ–Ω–∞
            const retailPerUnit = roundUpToWhole(wholesale + tevoMarkup);

            // –ù–∞–ª–æ–≥
            const taxPerUnit = roundUpToWhole(wholesale * (taxPercent / 100));

            // –¶–µ–Ω–∞ –ø–æ—Å–ª–µ –Ω–∞–ª–æ–≥–∞
            const priceAfterTaxPerUnit = roundUpToWhole(retailPerUnit + taxPerUnit);

            // –ù–∞—Ü–µ–Ω–∫–∞ –ø–∞—Ä—Ç–Ω–µ—Ä–∞
            let priceAfterMarkupPerUnit = priceAfterTaxPerUnit;
            if (markupType === 'fixed') {
                priceAfterMarkupPerUnit = roundUpToWhole(priceAfterMarkupPerUnit + markupValue);
            } else {
                const markupAmount = roundUpToWhole(priceAfterMarkupPerUnit * (markupValue / 100));
                priceAfterMarkupPerUnit = roundUpToWhole(priceAfterMarkupPerUnit + markupAmount);
            }

            // –ú–∞—Ä–∂–∞ –ø—Ä–∏–±—ã–ª–∏
            const costPrice = priceAfterTaxPerUnit;
            const sellingPrice = priceAfterMarkupPerUnit;
            const profitMargin = sellingPrice - costPrice;
            const profitMarginPercent = (profitMargin / costPrice) * 100 || 0;

            // –û–±—â–∏–µ —Å—É–º–º—ã
            const totalBeforeFee = priceAfterMarkupPerUnit * quantity;
            const serviceFee = roundUpToWhole(totalBeforeFee * (serviceFeePercent / 100));
            const finalPriceUSD = roundUpToWhole(totalBeforeFee + serviceFee);
            const pricePerTicket = roundUpToWhole(finalPriceUSD / quantity);

            // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤–∞–ª—é—Ç
            const finalPriceEUR = roundUpToWhole(finalPriceUSD * exchangeRates.EUR);
            const finalPriceGBP = roundUpToWhole(finalPriceUSD * exchangeRates.GBP);

            // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–≤–æ–¥–∞
            const calculationSteps = [
                `1. Base Wholesale Price: $${wholesale.toFixed(2)}`,
                `2. Tevo Markup: $${tevoMarkup} ${wholesale >= 1000 ? '(12% of wholesale)' : ''}`,
                `3. Retail Price: $${wholesale.toFixed(2)} + $${tevoMarkup} = $${retailPerUnit}`,
                `4. Tax Calculation: $${wholesale.toFixed(2)} √ó ${taxPercent}% = $${taxPerUnit}`,
                `5. Price after Tax: $${retailPerUnit} + $${taxPerUnit} = $${priceAfterTaxPerUnit}`,
                `6. Partner Markup: ${markupType === 'fixed' ? `+$${markupValue}` : `+${markupValue}%`}`,
                `7. Final Price per Ticket: $${priceAfterMarkupPerUnit}`,
                `8. Total for ${quantity} tickets: $${priceAfterMarkupPerUnit} √ó ${quantity} = $${totalBeforeFee}`,
                `9. Service Fee: $${totalBeforeFee} √ó ${serviceFeePercent}% = $${serviceFee}`,
                `10. Final Total: $${totalBeforeFee} + $${serviceFee} = $${finalPriceUSD}`
            ];

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            document.getElementById('detailed_calculation').innerHTML = calculationSteps.map(step => `<div>${step}</div>`).join('');
            document.getElementById('tax_per_unit').textContent = `$${taxPerUnit}`;
            document.getElementById('tax_calculation').textContent = `(Calculation: $${wholesale.toFixed(2)} √ó ${taxPercent}% = $${taxPerUnit})`;
            document.getElementById('profit_margin').textContent = `$${roundUpToWhole(profitMargin)}`;
            document.getElementById('profit_margin_percent').textContent = `${roundUpToWhole(profitMarginPercent)}%`;
            document.getElementById('total_before_fee').textContent = `$${totalBeforeFee}`;
            document.getElementById('service_fee_rate').textContent = `${serviceFeePercent}`;
            document.getElementById('service_fee').textContent = `$${serviceFee}`;
            document.getElementById('final_price').textContent = `$${finalPriceUSD}`;
            document.getElementById('price_per_ticket').textContent = `$${pricePerTicket}`;
            document.getElementById('final_price_eur').textContent = `‚Ç¨${finalPriceEUR} (1 USD = ${exchangeRates.EUR.toFixed(4)} EUR)`;
            document.getElementById('final_price_gbp').textContent = `¬£${finalPriceGBP} (1 USD = ${exchangeRates.GBP.toFixed(4)} GBP)`;
        }
    </script>
</body>
</html>
